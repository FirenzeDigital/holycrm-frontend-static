name: Deploy static site to GitHub Pages

on:
  push:
    branches: [ main ]          # or your default branch
  workflow_dispatch:           # allow manual runs

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read          # needed to checkout the repo
      pages: write            # needed to deploy to GitHub Pages
      id-token: write         # needed for OIDC authentication

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ (Optional) Install any build tools
      #    For a pure‑HTML/JS site you can skip this step.
      #    If you later add a bundler, uncomment the lines below.
      # - name: Set up Node
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: '20'
      # - name: Install dependencies
      #   run: npm ci

      # 3️⃣ Prepare the site folder
      #    GitHub Pages expects the files in the `artifact` directory.
      - name: Prepare artifact
        run: |
          mkdir -p artifact
          cp -R * artifact/
          # Remove the workflow file itself so it isn’t published
          rm -f artifact/.github/workflows/deploy.yml

      # 4️⃣ Deploy to GitHub Pages
      - name: Deploy to GitHub Pages
        uses: actions/configure-pages@v4
        with:
          # The branch where the site will be published (default: gh-pages)
          # You can change this if you use a different branch.
          branch: gh-pages

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: ./artifact

      - name: Deploy
        id: deployment
        uses: actions/deploy-pages@v2

      # 5️⃣ (Optional) Output the URL
      - name: Show deployment URL
        run: echo "✅ Site deployed to ${{ steps.deployment.outputs.page_url }}"
